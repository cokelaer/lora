<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- CCS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css"/>
    <style>
      {% include "lora.css" %}
    </style>
    <!-- Roboto font -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet"/>
  </head>
  <body>
    <section class="hero is-link">
      <div class="hero-body">
        <div class="container has-text-centered"></div>
        <p class="title">
          LORA Report
        </p>
        <p class="subtitle">
          Report created with <a href="https://github.com/sequana/lora">LORA</a> (v{{version}})
        </p>
      </div>
    </section>
    <section class="section">
      <div class="content">
        <h2>General Information</h2>
        <div class="table-container">
          <table id="lora_summary" class="table is-striped is-hoverable">
            <thead>
              <th>Sample</th>
              {% for header in summary['header'] %}
              <th class="has-text-right">{{header}}</th>
              {% endfor %}
            </thead>
            <tbody>
              {% for sample, values in summary['results'].items() %}
              <tr id={{"defaultOpenAssembly" if loop.first else "row_" ~ loop.index0}}>
                <td><strong>{{sample}}</strong></td>
                {% for value in values %}
                <td class="has-text-right roboto-mono">{{value}}</td>
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </div>
        </table>
        {% if analysis %}
          {% for sample, contigs_dict in analysis.items() %}
            <div id="{{sample}}" class="analysis">
              <h3>{{sample}}</h3>
              {% for contig, results in contigs_dict.items() %}
                <h4>{{contig}}</h4>
                {% if 'coverage' in results %}
                  <h5>Sequana Coverage</h5>
                  <div class="columns is-vcentered">
                    <div class="column">
                      <table id="{{sample}}_{{contig}}_sequana" class="table is-striped is-hoverable">
                        <tbody>
                          {% for key, value in results['coverage'].items() %}
                          <tr>
                            <td><strong>{{key}}</strong></td>
                            <td>{{value}}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                    <div class='column has-text-centered'>
                      <img src="data:image/png;base64,{{results['cov_image']}}" />
                    </div>
                  </div>
                {% endif %}
                {% if 'blast' in results %}
                  <h5>Blast</h5>
                  <div class="table-container">
                    <table id="{{sample}}_{{contig}}_blast" class="table is-striped is-hoverable">
                      <thead>
                          {% for title in results['blast'][0].keys() %}
                            <th class={{ "has-text-left" if loop.first else "has-text-right" }}>{{title}}</th>
                          {% endfor %}
                      </thead>
                      <tbody>
                        {% for blast in results['blast'] %}
                        <tr>
                          {% for value in blast.values() %}
                          <td class={{ "has-text-left" if loop.first else "has-text-right" }}>{{value}}</td>
                          {% endfor %}
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                {% endif %} 
              {% endfor %}
            </div>
          {% endfor %}
        {% endif %}
      </div>
    </section>
    <!-- Javascript -->
    <script type="text/javascript">
      {% include "lora.js" %}
    </script>
  </body>
  <footer class="footer">
    <div class="content has-text-centered">
      <p>
        <strong>LORA</strong> by <a href="https://sequana.readthedocs.io/en/master/">Sequana Team</a>. The source code is licensed
        <a href="https://opensource.org/licenses/BSD-3-Clause">BSD3</a>.
      </p>
    </div>
  </footer>
</html>
